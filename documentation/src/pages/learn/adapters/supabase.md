---
order: 1
layout: "@layouts/DocumentLayout.astro"
title: "Supabase"
---

An adapter for Supabase (v1) PostgreSQL database. **Make sure to enable row level security for all tables!**

```ts
const adapter: (url: string, secret: string) => Adapter;
```

### Parameter

| name   | type     | description                         |
| ------ | -------- | ----------------------------------- |
| url    | `string` | Supabase project url                |
| secret | `string` | `service_role` secret; NOT anon key |

## Installation

```bash
npm i @lucia-sveltekit/adapter-supabase
pnpm add @lucia-sveltekit/adapter-supabase
yarn add @lucia-sveltekit/adapter-supabase
```

## Usage

```ts
import supabase from "@lucia-sveltekit/adapter-supabase";

const auth = lucia({
    adapter: supabase(url, secret),
});
```

## Database structure

`uuid` should be changed to `varchar` if you use custom user ids.

### `user`

You may add additional columns to store custom user data. Refer to [Store additional user data](/learn/basics/store-additional-user-data). `id` may be `varchar` if you generate your own user id.

| name            | type      | foreign constraint | default              | nullable | unique | identity |
| --------------- | --------- | ------------------ | -------------------- | -------- | ------ | -------- |
| id              | `uuid`    |                    | `generate_uuid_v4()` |          | true   | true     |
| provider_id     | `varchar` |                    |                      |          | true   |          |
| hashed_password | `string`  |                    |                      | true     |        |          |

### `session`

| name         | type      | foreign constraint | nullable | unique | identity |
| ------------ | --------- | ------------------ | -------- | ------ | -------- |
| id           | `int8`    |                    |          | true   | true     |
| user_id      | `uuid`    | `primary:user.id`  |          |        |          |
| access_token | `varchar` |                    |          | true   |          |
| expires      | `int8`    |                    |          |        |          |

### `refresh_token`

| name          | type      | foreign constraint | nullable | unique | identity |
| ------------- | --------- | ------------------ | -------- | ------ | -------- |
| id            | `int8`    |                    |          | true   | true     |
| user_id       | `uuid`    | `primary:user.id`  |          |        |          |
| refresh_token | `varchar` |                    |          | true   |          |

## SQL Example for creation database in SupaBase SQL Editor 
`uuid` in `user` table should be changed to `varchar` if you use custom user ids.
You may add additional columns to store custom user data in `user` table. Refer to [Store additional user data](/learn/basics/store-additional-user-data).

```sql
CREATE TABLE public.user (
	id UUID DEFAULT extensions.uuid_generate_v4() PRIMARY KEY,
	provider_id VARCHAR NOT NULL UNIQUE,
	hashed_password TEXT NULL
);

CREATE TABLE public.session (
  id INT8 GENERATED BY DEFAULT AS IDENTITY UNIQUE,
	user_id UUID REFERENCES public.user(id),
	access_token VARCHAR NOT NULL UNIQUE,
	expires INT8 NOT NULL
);

CREATE TABLE public.refresh_token (
  id INT8 GENERATED BY DEFAULT AS IDENTITY UNIQUE,
	user_id UUID REFERENCES public.user(id),
	refresh_token VARCHAR NOT NULL UNIQUE
);

ALTER TABLE public.user ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.session ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.refresh_token ENABLE ROW LEVEL SECURITY;

COMMENT ON TABLE public.user IS '[Lucia] Users';
COMMENT ON TABLE public.session IS '[Lucia] User Sessions';
COMMENT ON TABLE public.refresh_token IS '[Lucia] Users Token';
```
